# [Blue Team Labs Online - Deep Blue](https://blueteamlabs.online/home/investigation/deep-blue-a4c18ce507)
Created: 11/05/2024 13:26
Last Updated: 14/05/2024 11:18
* * *
<div align=center>

![9f6a6dbab512d89bc99e43c1e9142f2c.png](../../../_resources/9f6a6dbab512d89bc99e43c1e9142f2c-1.png)
</div>

>A Windows workstation was recently compromised, and evidence suggests it was an attack against internet-facing RDP, then Meterpreter was deployed to conduct 'Actions on Objectives'. Can you verify these findings?

>**Tags**: DeepBlueCLI, PowerShell, Event Viewer, T1133, T1078.003, T1136.001, T1543.003
* * *

**Scenario**
A Windows workstation was recently compromised, and evidence suggests it was an attack against internet-facing RDP, then Meterpreter was deployed to conduct 'Actions on Objectives'. Can you verify these findings?

You have been provided with the Security.evtx and System.evtx log exports from the compromised system - you should analyze these, NOT the Windows logs generated by the lab machine (when using DeepBlueCLI ensure you're providing the path to these files, stored inside `\Desktop\Investigation\`.

**Reading Material:**
https://github.com/sans-blue-team/DeepBlueCLI
* * *
## Investigation Submission
> Using DeepBlueCLI, investigate the recovered Security log (Security.evtx). Which user account ran GoogleUpdate.exe?

![69d31b2e3ba607aebf9cc4c9d75c360b.png](../../../_resources/69d31b2e3ba607aebf9cc4c9d75c360b-1.png)
Once we connected to the system lab, there is an "Investigation" folder on the desktop, and after examining this folder we got 3 tools (CyberChef, DeepBlueCLI) for investigation and 2 event log files ("System.evtx" and "Security.evtx")

Then to run DeepBlueCLI we need to open PowerShell as administrator then `cd C:\Users\BTLOTest\Desktop\Investigation\DeepBlueCLI-master` to navigate to DeepBlueCLI powershell script

Then we use `.\DeepBlue.ps1 ..\Security.evtx` to process Security log file
![78ab46ae78b3efaf607350c7555659c8.png](../../../_resources/78ab46ae78b3efaf607350c7555659c8-1.png)
As you can see that "GoogleUpdate.exe" was executed from "Mike Smith" Downloads folder

![c156039213a895e81e9a9f5341a3bdf2.png](../../../_resources/c156039213a895e81e9a9f5341a3bdf2-1.png)
After encoded, its not look so suspicious at this point

```
Mike Smith
```

> Using DeepBlueCLI investigate the recovered Security.evtx log. At what time is there likely evidence of Meterpreter activity?

![ef0cd017d03829fda77927536a9fedc1.png](../../../_resources/ef0cd017d03829fda77927536a9fedc1-1.png)
Scrolling up and down for a bit then you will see this event that DeepBlueCLI considered it as a command from meterpreter
```
4/10/2021 10:48:14
```

> Using DeepBlueCLI investigate the recovered System.evtx log. What is the name of the suspicious service created?

Using `.\DeepBlue.ps1 ..\System.evtx` command to process System log file
![02cd28ed1091938a2d4e5e8fbb1fc0bc.png](../../../_resources/02cd28ed1091938a2d4e5e8fbb1fc0bc-1.png)
There is not much event here so the first event will eventually catch our eyes and its a metasploit activity to create a service

```
rztbzn
```

>Investigate the Security.evtx log in Event Viewer. Process creation is being audited (event ID 4688). Identify the malicious executable downloaded that was used to gain a Meterpreter reverse shell, between 10:30 and 10:50 AM on the 10th of April 2021. 


![6e679c81ad96c39d8e309f2147e1b6cc.png](../../../_resources/6e679c81ad96c39d8e309f2147e1b6cc-1.png)

"4/10/2021 10:48:14 AM"
![5d26cf3b2b4ce6563f50bf9fecd58cc2.png](../../../_resources/5d26cf3b2b4ce6563f50bf9fecd58cc2-1.png)
```
Mike Smith, serviceupdate.exe
```

>It's also believed that an additional account was created to ensure persistence between 11:25 AM and 11:40 AM on the 10th April 2021. What was the command line used to create this account? (Make sure you've found the right account!)

![aad5d1c3e1ac7ea6a3bc762074ed9d2e.png](../../../_resources/aad5d1c3e1ac7ea6a3bc762074ed9d2e-1.png)
![0f784028d8204054b18de8d3ceed39ca.png](../../../_resources/0f784028d8204054b18de8d3ceed39ca-1.png)
But look like this is not the right one 

![a992f96eed102fa467695c8bf36126e4.png](../../../_resources/a992f96eed102fa467695c8bf36126e4-1.png)
![cd0500b05563295c5a7b37016a920b15.png](../../../_resources/cd0500b05563295c5a7b37016a920b15-1.png)

![e651666f5de59ace824280442bd82e61.png](../../../_resources/e651666f5de59ace824280442bd82e61-1.png)
```
net user ServiceAct /add
```

> What two local groups was this new account added to?
```
administrators, Remote Desktop Users
```

![302a633c6c7d72abc35b889e028a30ac.png](../../../_resources/302a633c6c7d72abc35b889e028a30ac.png)
* * *